{% extends 'body.html' %}
{% load static %}

{% block contenido %}

<div class="card">
  <div class="card-header">
    <h3 class="card-title">Listado de Vehículos</h3>
  </div>

  <div class="card-body">
    <table class="table table-bordered table-hover" id="tabla">
      <thead>
        <tr>
          <th>#</th>
          <th>Tipo Vehículo</th>
          <th>Placa</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Kilometraje</th>
          <th>Documento</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for v in vehiculo %}
        <tr>
          <td>{{ v.id }}</td>
          <td>{{ v.tipo_vehiculo }}</td>
          <td>{{ v.placa }}</td>
          <td>{{ v.marca }}</td>
          <td>{{ v.modelo }}</td>
          <td>{{ v.kilometraje }}</td>
          <td>{{ v.documento }}</td>
          <td>
            <!-- Botón Editar -->
            <a href="{% url 'app:editar_vehiculo' v.id %}"
               class="btn btn-warning btn-sm editar">
              <i class="fas fa-edit"></i>
            </a>

            <!-- Botón Eliminar -->
            <form action="{% url 'app:eliminar_vehiculo' v.id %}" method="post" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="btn btn-danger btn-sm eliminar">
                <i class="fas fa-trash"></i>
              </button>
            </form>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="card-footer">
    <a href="{% url 'app:crear_vehiculo' %}" class="btn btn-primary">
      <i class="fas fa-plus"></i> Nuevo Vehículo
    </a>
  </div>
</div>

{% endblock %}

{% block js %}
<script src="{% static 'lib/jquery/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'lib/datatables-1.10.20/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'lib/datatables-1.10.20/js/dataTables.bootstrap4.min.js' %}"></script>
<script src="{% static 'lib/sweetalert2/sweetalert2.all.min.js' %}"></script>

<script>
  $(document).ready(function () {
    $('#tabla').DataTable({
      responsive: true,
      autoWidth: false,
      language: {
        url: "//cdn.datatables.net/plug-ins/1.10.20/i18n/Spanish.json"
      }
    });
  });

  // ALERTAS SweetAlert2
  document.addEventListener("DOMContentLoaded", function () {

    // Botones Editar
    const botonesEditar = document.querySelectorAll('.editar');
    botonesEditar.forEach(btn => {
      btn.addEventListener('click', (e) => {
        Swal.fire({
          icon: 'success',
          title: 'Editado correctamente',
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'Aceptar'
        });
      });
    });

    // Botones Eliminar
    const botonesEliminar = document.querySelectorAll('.eliminar');
    botonesEliminar.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault(); // Evita enviar el formulario inmediatamente

        Swal.fire({
          title: '¿Estás seguro?',
          text: "¡No podrás revertir esto!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#3085d6',
          confirmButtonText: 'Sí, eliminar',
          cancelButtonText: 'Cancelar'
        }).then((result) => {
          if (result.isConfirmed) {
            const form = btn.closest('form');
            if(form) form.submit(); // envía el formulario solo si confirma
          }
        });
      });
    });

  });
</script>
{% endblock %}